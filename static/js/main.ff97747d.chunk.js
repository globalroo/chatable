(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{102:function(t,e,n){},177:function(t,e,n){},179:function(t,e,n){},181:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n.n(a),o=n(20),u=n.n(o),i=(n(102),n(58)),l=n.n(i),c=n(43),s=n(80),d=n(25),m=n(18),p=n(23),g=n(94),v=n(26),E=n(3),f=n(92),b=n(93),h=n(12),y=n(84),w=n(81),O=null,j=function(t){var e=t.token;return O=e},C=Object(w.a)(function(t,e){var n=e.headers,a=O;return{headers:Object(g.a)({},n,{authorization:a?"Bearer ".concat(a):""})}}),$=Object(h.d)(function(t){var e=t.query,n=Object(E.k)(e),a=n.kind,r=n.operation;return"OperationDefinition"===a&&"subscription"===r},new y.a({uri:"wss://subscriptions.graph.cool/v1/cjhdp4tzl2r890195ggdfyv2h",options:{reconnect:!0}}),new f.a({uri:"https://api.graph.cool/simple/v1/cjhdp4tzl2r890195ggdfyv2h"})),k=new v.a({link:C.concat($),cache:new b.a}),S=n(182),I=n(186),G=n(183),D=n(185),N=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=Object(a.useState)(t),n=Object(d.a)(e,2),r=n[0],o=n[1];return{value:r,onChange:function(t){return o(t.target.value)}}},L=function(t){var e=t.handleLogin,n=Object(a.useState)(!0),o=Object(d.a)(n,2),u=o[0],i=o[1],l=N(),c=N(),s=N();return r.a.createElement(S.a.Dialog,null,r.a.createElement(S.a.Body,null,r.a.createElement("div",{className:"login-logo-container"},r.a.createElement("h1",null,"Chatable"),r.a.createElement("h5",null,"Create a user or use 'test/test' for signin")),r.a.createElement("div",{className:"login-title-container"},r.a.createElement("span",{className:"login-title-text"},u?"Login":"Sign Up")),r.a.createElement(I.a,null,!u&&r.a.createElement(G.a,Object.assign({autoFocus:!0,type:"text",placeholder:"Your name (to be used in chat)"},c)),r.a.createElement(G.a,Object.assign({autoFocus:!0,type:"email",placeholder:"Email"},l)),r.a.createElement(G.a,Object.assign({type:"password",placeholder:"Password"},s))),r.a.createElement(I.a,null,r.a.createElement(D.a,{className:"pointer",onClick:function(){return i(!u)}},u?"Don't have an account? Sign up":"Have an account? Log in"),r.a.createElement(D.a,{className:"pull-right pointer",onClick:function(){return e({name:c.value,email:l.value,password:s.value})}},u?"Login":"Create User"))))},x=n(19),T=n.n(x);n(177);function A(){var t=Object(m.a)(["\n\t{\n\t\tallGroups(orderBy: name_ASC) {\n\t\t\tid\n\t\t\tname\n\t\t\tdescription\n\t\t}\n\t}\n"]);return A=function(){return t},t}var U=T()(A()),B=function(t){var e=t.group;return r.a.createElement(p.c,{query:U},function(t){var n=t.loading,a=t.error,o=t.data;return n?r.a.createElement("p",null,"Loading..."):a?r.a.createElement("p",null,"Error :( ",JSON.stringify(a)):r.a.createElement("ul",{style:{color:"white"}},o.allGroups.map(function(t,n){var a=t.id===e.id,o="groupSelector_".concat(t.id);return r.a.createElement("li",{key:o,"data-testid":o},t.name," ",r.a.createElement("br",null),"[",t.id,"]",r.a.createElement("br",null),a?"Current Group":"")}))})},J=n(184);function F(){var t=Object(m.a)(["\n\tmutation createGroupChatEntry($fromId: ID!, $content: String!, $groupId: ID!) {\n\t\tcreateGroupChatEntry(fromId: $fromId, content: $content, groupId: $groupId) {\n\t\t\tcontent\n\t\t\tfrom {\n\t\t\t\tname\n\t\t\t\tid\n\t\t\t}\n\t\t\tgroup {\n\t\t\t\tid\n\t\t\t}\n\t\t\tid\n\t\t\tcreatedAt\n\t\t}\n\t}\n"]);return F=function(){return t},t}var q=T()(F()),M=function(t){var e,n=t.user,a=t.group,o=t.createGroupChatEntry;return r.a.createElement("div",null,r.a.createElement("form",{onSubmit:function(t){t.preventDefault(),e.value.length>0&&(o({variables:{fromId:n.id,content:e.value,groupId:a.id}}),e.value="")}},r.a.createElement(I.a,null,r.a.createElement(J.a,null,r.a.createElement(G.a,{type:"text",placeholder:"Type to talk...",autoFocus:!0,inputRef:function(t){e=t}}),r.a.createElement(J.a.Button,null,r.a.createElement(D.a,{className:"btn btn-primary",type:"submit"},"Send"))))))},P=function(t){var e=t.user,n=t.group;return r.a.createElement(p.b,{mutation:q},function(t){return r.a.createElement(M,{createGroupChatEntry:t,user:e,group:n})})},z=n(91);function Q(){var t=Object(m.a)(["\n\tsubscription changedGroupChatEntry($groupId: ID!) {\n\t\tGroupChatEntry(\n\t\t\tfilter: { mutation_in: [CREATED, UPDATED, DELETED], node: { group: { id: $groupId } } }\n\t\t) {\n\t\t\tmutation\n\t\t\tnode {\n\t\t\t\tfrom {\n\t\t\t\t\tname\n\t\t\t\t\tid\n\t\t\t\t}\n\t\t\t\tid\n\t\t\t\tcontent\n\t\t\t\tedited\n\t\t\t\tdeleted\n\t\t\t\tcreatedAt\n\t\t\t\tgroup {\n\t\t\t\t\tid\n\t\t\t\t}\n\t\t\t}\n\t\t\tupdatedFields\n\t\t\tpreviousValues {\n\t\t\t\tcontent\n\t\t\t\tid\n\t\t\t}\n\t\t}\n\t}\n"]);return Q=function(){return t},t}var R=T()(Q()),_=function(t){var e=t.loading,n=t.error,o=t.subscribeToMore,u=t.group,i=t.apolloQuery;Object(a.useEffect)(function(){var t=o({document:R,variables:{groupId:u.id},updateQuery:function(t,e){var n=e.subscriptionData.data;if(!n)return t;var a=n.GroupChatEntry,r=a.mutation,o=a.node,u=t.allGroupChatEntries,i=void 0===u?[]:u;switch(r){case"CREATED":return Object.assign({},t,{allGroupChatEntries:[].concat(Object(z.a)(i),[o])});default:return t}}});return function(){t()}},[]);var l=i.data.allGroupChatEntries;return e?r.a.createElement("p",null,"Loading..."):n?r.a.createElement("p",null,"Error :( ",JSON.stringify(n)):l?r.a.createElement("ul",null,l.filter(function(t){return!0!==t.deleted}).map(function(t){return r.a.createElement("li",{key:t.id},JSON.stringify(t))})):null};function W(){var t=Object(m.a)(["\n\tquery allGroupChatEntries($groupId: ID!) {\n\t\tallGroupChatEntries(filter: { group: { id: $groupId } }) {\n\t\t\tfrom {\n\t\t\t\tname\n\t\t\t\tid\n\t\t\t}\n\t\t\tid\n\t\t\tcontent\n\t\t\tedited\n\t\t\tdeleted\n\t\t\tcreatedAt\n\t\t}\n\t}\n"]);return W=function(){return t},t}var H=T()(W()),V=function(t){var e=t.user,n=t.group;return console.log({group:n}),r.a.createElement(p.c,{query:H,fetchPolicy:"network-only",variables:{groupId:n.id}},function(t){var a=t.subscribeToMore,o=Object(c.a)(t,["subscribeToMore"]);return r.a.createElement(_,{apolloQuery:o,group:n,subscribeToMore:a,user:e})})},Y=function(t){var e=t.user,n=t.group,a=t.handleLogout;return console.log(e),r.a.createElement("div",{className:"app-layout"},r.a.createElement("div",{className:"channels box"},r.a.createElement("div",null," List channels "),r.a.createElement(B,{group:n})),r.a.createElement("div",{className:"header"},JSON.stringify(e)," ",r.a.createElement("button",{onClick:a},"Logout")),r.a.createElement("div",{className:"messages box scroll-container"},r.a.createElement(V,{group:n})),r.a.createElement("div",{className:"input box"},r.a.createElement(P,{user:e,group:n})))};n(179);function K(){var t=Object(m.a)(["\n\tmutation login($email: String!, $password: String!) {\n\t\tsigninUser(email: { email: $email, password: $password }) {\n\t\t\ttoken\n\t\t\tuser {\n\t\t\t\tid\n\t\t\t\tname\n\t\t\t\temail\n\t\t\t}\n\t\t}\n\t}\n"]);return K=function(){return t},t}function X(){var t=Object(m.a)(["\n\tmutation createUserAndSignOn($name: String!, $email: String!, $password: String!) {\n\t\tcreateUser(name: $name, authProvider: { email: { email: $email, password: $password } }) {\n\t\t\tid\n\t\t}\n\t\tsigninUser(email: { email: $email, password: $password }) {\n\t\t\ttoken\n\t\t\tuser {\n\t\t\t\tid\n\t\t\t\tname\n\t\t\t\temail\n\t\t\t}\n\t\t}\n\t}\n"]);return X=function(){return t},t}var Z=T()(X()),tt=T()(K()),et=function(){var t=Object(a.useState)(),e=Object(d.a)(t,2),n=e[0],o=e[1],u=Object(a.useState)(),i=Object(d.a)(u,2),m=i[0],g=i[1],v=function(){var t=Object(s.a)(l.a.mark(function t(e){var n,a,r,u,i,s,d,m,p,v,E;return l.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.name,a=e.email,r=e.password,g(null),o(null),t.prev=3,t.next=6,k.mutate({mutation:""===n?tt:Z,variables:{name:n,email:a,password:r}});case 6:u=t.sent,i=u.data,s=(void 0===i?{}:i).signinUser,m=(d=void 0===s?{}:s).token,p=void 0===m?"":m,v=Object(c.a)(d,["token"]),E=v.user,j(p),o(E),t.next=18;break;case 15:t.prev=15,t.t0=t.catch(3),g(t.t0.message);case 18:case"end":return t.stop()}},t,null,[[3,15]])}));return function(e){return t.apply(this,arguments)}}();return r.a.createElement(p.a,{client:k},r.a.createElement(r.a.Fragment,null,n?r.a.createElement(Y,{user:n,group:{name:"General",id:"cjtxbbp3yglac0183o1oovog7"},handleLogout:function(){o(void 0),j({token:null}),k.resetStore()}}):r.a.createElement(L,{handleLogin:v}),m&&r.a.createElement("div",null,m)))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));u.a.render(r.a.createElement(et,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(t){t.unregister()})},97:function(t,e,n){t.exports=n(181)}},[[97,1,2]]]);
//# sourceMappingURL=main.ff97747d.chunk.js.map